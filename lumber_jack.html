<html xmlns="http://www.w3.org/1999/xhtml">
<meta charset="UTF-8">
<head>
    <style>
        body {
            background-color: #fff;
            margin: 0px;
            height: 100%;
            overflow: hidden;
        }

        #lottie {
            background-color: #fff;
            width: 100%;
            height: 100%;
            display: block;
            overflow: hidden;
            transform: translate3d(0, 0, 0);
            text-align: center;
            opacity: 1;
        }

    </style>
</head>
<body>
<script src="lib/lottie.js" type="text/javascript"></script>


<div id="lottie"></div>

<script>


    class Key {
        constructor(frame, position) {
            this.frame = frame;
            this.position = position;
        }
    }

    class Layer {
        constructor(name, keys) {
            this.name = name;
            this.keys = keys;
        }
    }

    var params = {
        container: document.getElementById('lottie'),
        renderer: 'svg',
        loop: true,
        autoplay: true,
        path: "anim/lumber_jack.json"
    };

    var anim;

    anim = lottie.loadAnimation(params);
    anim.addEventListener("DOMLoaded", function () {
        animRel = anim.animationData.w / anim.animationData.h;
        calculateScale();
        window.addEventListener("mousemove", function (ev) {
            var xPos = (ev.pageX - windowSize.w / 2) * scale;
            var yPos = (ev.pageY - windowSize.h / 2) * scale;
            //console.log(ev.pageX - windowSize.w/2);

            anim.animationData.layers[0].ks.p.k[0].s = [xPos, yPos, 0];
            anim.animationData.layers[0].ks.p.k[1].s = [xPos, yPos, 0];

            //console.log(anim.animationData.layers[0].ks.p.k[0].s);


        });

    });
    getAllLayers();

    animation.onEnterFrame = function (e) {
        console.log('yo', e.currentTime, i++);
    };


    window.addEventListener("resize", function (ev) {
        windowSize.w = window.innerWidth;
        windowSize.h = window.innerHeight;
        elemSize.w = elem.clientWidth;
        elemSize.h = elem.clientHeight;
        calculateScale();
    });

    function calculateScale() {
        var elemRel = anim.animationData.w / anim.animationData.h;
        if (animRel > elemRel) {
            scale = anim.animationData.w / elemSize.w;
        } else {
            scale = anim.animationData.h / elemSize.h;
        }
        //Scale adjustment for parented layer
        scale /= 1.5;
    }

    var windowSize = {
        w: window.innerWidth,
        h: window.innerHeight
    };
    var elemSize = {
        w: elem.clientWidth,
        h: elem.clientHeight
    };


    function getDimen() {
        return elem.clientWidth + "-" + elem.clientHeight
    }


    function setXY(x, y) {
        anim.animationData.layers[0].ks.p.k[0].s = [x, y, 0];
        anim.animationData.layers[0].ks.p.k[1].s = [x, y, 0];
    }

    function getAllLayers() {
        var layers = [];
        for (item in anim.animationData.layers) {
            var keys = []
            for (keyIndex in anim.animationData.layers[item].ks.p.k) {
                if (anim.animationData.layers[item].ks.p.k[keyIndex].s != null)
                    keys.push(new Key(anim.animationData.layers[item].ks.p.k[keyIndex].t, anim.animationData.layers[item].ks.p.k[keyIndex].s))
            }
            layers.push(new Layer(anim.animationData.layers[item].nm, keys));
        }
        console.log(layers);
    }

</script>
</body>
</html>
